<!-- Code generated by gomarkdoc. DO NOT EDIT -->

# tracing

```go
import "github.com/aexvir/skladka/internal/tracing"
```

Package tracing provides a thin wrapper around [OpenTelemetry](<https://pkg.go.dev/go.opentelemetry.io/otel/sdk/trace>)'s tracing sdk.

The tracer instance is meant to be initialized as a singleton and injected into the context during the initialization of the application. Only the otlp exporter via grpc is currently supported but extending this support should be fairly simple.

Every function that wants to create a span should use the [tracing.FromContext](<#FromContext>) helper to obtain an instrumented context as well as its close function.

### example usage

```
// initialize tracer instance
tracer, err := tracing.NewTracer("service", "environment", "version")
	if err != nil {
	return fmt.Errorf("failed to initialize tracing: %w", err)
}

// inject tracer into context
ctx := tracing.NewContext(context.Background(), tracer)

// anywhere else in the code that should be instrumented
var err error
ctx, finish := tracing.FromContext(ctx, trace.SpanKindInternal, "domain.OperatioName")
defer finish(&err)
```

## Index

- [func FromContext\(ctx context.Context, kind trace.SpanKind, operation string, attributes ...attribute.KeyValue\) \(context.Context, func\(err \*error\)\)](<#FromContext>)
- [func NewContext\(parent context.Context, tracer \*Tracer\) context.Context](<#NewContext>)
- [type CloseSpanFn](<#CloseSpanFn>)
- [type Tracer](<#Tracer>)
  - [func NewTracer\(service, env, version string, opts ...TracerOption\) \(\*Tracer, func\(context.Context\) error, error\)](<#NewTracer>)
- [type TracerOption](<#TracerOption>)
  - [func WithOtlpExporter\(ctx context.Context, hostname string, port int\) TracerOption](<#WithOtlpExporter>)
  - [func WithSampleRate\(value float64\) TracerOption](<#WithSampleRate>)
  - [func WithStdOutExporter\(\) TracerOption](<#WithStdOutExporter>)


<a name="FromContext"></a>
## func [FromContext](<https://github.com/aexvir/skladka/blob/master/internal/tracing/context.go#L26-L30>)

```go
func FromContext(ctx context.Context, kind trace.SpanKind, operation string, attributes ...attribute.KeyValue) (context.Context, func(err *error))
```

FromContext starts a new span and returns a new context instrumented with said span, as well as the function to close the span. The caller \*must\* call the close function. If no tracer instance is present in the context, this function is no\-op.

<a name="NewContext"></a>
## func [NewContext](<https://github.com/aexvir/skladka/blob/master/internal/tracing/context.go#L18>)

```go
func NewContext(parent context.Context, tracer *Tracer) context.Context
```

NewContext returns a new context where the specified tracer has been injected to as value.

<a name="CloseSpanFn"></a>
## type [CloseSpanFn](<https://github.com/aexvir/skladka/blob/master/internal/tracing/context.go#L14>)



```go
type CloseSpanFn func(err *error)
```

<a name="Tracer"></a>
## type [Tracer](<https://github.com/aexvir/skladka/blob/master/internal/tracing/tracer.go#L13-L19>)

Tracer is a wrapper around the OpenTelemetry TracerProvider.

```go
type Tracer struct {
    // contains filtered or unexported fields
}
```

<a name="NewTracer"></a>
### func [NewTracer](<https://github.com/aexvir/skladka/blob/master/internal/tracing/tracer.go#L26>)

```go
func NewTracer(service, env, version string, opts ...TracerOption) (*Tracer, func(context.Context) error, error)
```

NewTracer creates a new tracer with the given service name, environment and version. Additional options can be provided to customize the tracer behavior.

Returns the tracer instance, a shutdown function, and any error that occurred during initialization. The shutdown function should be called when the application is shutting down to ensure all spans are flushed.

<a name="TracerOption"></a>
## type [TracerOption](<https://github.com/aexvir/skladka/blob/master/internal/tracing/options.go#L19>)

TracerOption allows customizing the tracer behaviour. Use option functions only as part of tracer initialization, do not call them outside of this process.

```go
type TracerOption func(*Tracer) error
```

<a name="WithOtlpExporter"></a>
### func [WithOtlpExporter](<https://github.com/aexvir/skladka/blob/master/internal/tracing/options.go#L34>)

```go
func WithOtlpExporter(ctx context.Context, hostname string, port int) TracerOption
```

WithOtlpExporter configures the traces to be exported via OTLP to the specified endpoint. This option should only be used to initialize the tracer and it's not safe for concurrent use.

<a name="WithSampleRate"></a>
### func [WithSampleRate](<https://github.com/aexvir/skladka/blob/master/internal/tracing/options.go#L24>)

```go
func WithSampleRate(value float64) TracerOption
```

WithSampleRate configures the sampling rate for traces. This option should only be used to initialize the tracer and it's not safe for concurrent use.

<a name="WithStdOutExporter"></a>
### func [WithStdOutExporter](<https://github.com/aexvir/skladka/blob/master/internal/tracing/options.go#L58>)

```go
func WithStdOutExporter() TracerOption
```

WithStdOutExporter configures the tracer to print traces to standard output. This output is very verbose and logs a bunch of json without further processing. This option should only be used to initialize the tracer and it's not safe for concurrent use.

Generated by [gomarkdoc](<https://github.com/princjef/gomarkdoc>)
